!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("three"),require("three.texttexture")):"function"==typeof define&&define.amd?define(["three","three.texttexture"],e):e(t.THREE)}(this,function(t){"use strict";var e=new((t=t&&t.hasOwnProperty("default")?t.default:t).Vector3),r=new t.Vector3,i=new t.Vector3;t.TextSprite=function(a){function o(e){void 0===e&&(e={});var r=e.textSize;void 0===r&&(r=1);var i=e.redrawInterval;void 0===i&&(i=1);var o=e.maxFontSize;void 0===o&&(o=1/0);var n=e.material;void 0===n&&(n={});var p=e.texture;void 0===p&&(p={}),a.call(this,new t.SpriteMaterial(Object.assign({},n,{map:new t.TextTexture(p)}))),this.textSize=r,this.redrawInterval=i,this.maxFontSize=o,this.lastRedraw=0}a&&(o.__proto__=a),o.prototype=Object.create(a&&a.prototype),o.prototype.constructor=o;var n={isTextSprite:{configurable:!0}};return n.isTextSprite.get=function(){return!0},o.prototype.onBeforeRender=function(t,e,r){this.redraw(t,r)},o.prototype.updateScale=function(){this.scale.set(this.material.map.aspect,1,1).multiplyScalar(this.textSize*this.material.map.paddingBoxHeight)},o.prototype.updateMatrix=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.updateScale(),a.prototype.updateMatrix.apply(this,t)},o.prototype.redraw=function(t,e){var r=this;this.lastRedraw+this.redrawInterval<Date.now()&&(this.redrawInterval?setTimeout(function(){r.redrawNow(t,e)},1):this.redrawNow(t,e))},o.prototype.redrawNow=function(a,o){this.updateScale(),this.material.map.fontSize=Math.min(t.Math.ceilPowerOfTwo(function(t,a,o){if(a.domElement.width&&a.domElement.height&&t.material.map.lines.length){var n=t.getWorldPosition(e).distanceTo(o.getWorldPosition(r));if(n){var p=t.getWorldScale(i).y*a.domElement.height/n;if(p)return Math.round(p/t.material.map.paddingBoxHeight)}}return 0}(this,a,o)),this.maxFontSize),this.material.map.autoRedraw||this.material.map.redraw(),this.lastRedraw=Date.now()},o.prototype.dispose=function(){this.material.map.dispose(),this.material.dispose()},Object.defineProperties(o.prototype,n),o}(t.Sprite)});
