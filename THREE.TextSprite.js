!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three"),require("three.texttexture")):"function"==typeof define&&define.amd?define(["three","three.texttexture"],e):(t.THREE=t.THREE||{},t.THREE.TextSprite=e(t.THREE,t.THREE.TextTexture))}(this,function(p,d){"use strict";d=d&&d.hasOwnProperty("default")?d.default:d;var o=new p.Vector3,n=new p.Vector3,h=new p.Vector3;return function(s){function t(t){void 0===t&&(t={});var e=t.textSize;void 0===e&&(e=1);var i=t.redrawInterval;void 0===i&&(i=1);var r=t.maxFontSize;void 0===r&&(r=1/0);var a=t.material;void 0===a&&(a={});var o=t.texture;void 0===o&&(o={});var n=t.minFontSize;void 0===n&&(n=6),s.call(this,new p.SpriteMaterial(Object.assign({},a,{map:new d(o)}))),this.textSize=e,this.redrawInterval=i,this.maxFontSize=r,this.lastRedraw=0,this.minFontSize=n}s&&(t.__proto__=s),(t.prototype=Object.create(s&&s.prototype)).constructor=t;var e={isTextSprite:{configurable:!0}};return e.isTextSprite.get=function(){return!0},t.prototype.onBeforeRender=function(t,e,i){this.redraw(t,i)},t.prototype.updateScale=function(){this.scale.set(this.material.map.imageAspect,1,1).multiplyScalar(this.textSize*this.material.map.imageHeight)},t.prototype.updateMatrix=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.updateScale(),s.prototype.updateMatrix.apply(this,t)},t.prototype.redraw=function(t,e){var i=this;this.lastRedraw+this.redrawInterval<Date.now()&&(this.redrawInterval?setTimeout(function(){i.redrawNow(t,e)},1):this.redrawNow(t,e))},t.prototype.redrawNow=function(t,e){this.updateScale(),this.material.map.autoRedraw=!0;var i=p.Math.ceilPowerOfTwo(function(t,e,i){if(e.domElement.width&&e.domElement.height&&t.material.map.textLines.length){var r=t.getWorldPosition(o).distanceTo(i.getWorldPosition(n));if(r){var a=t.getWorldScale(h).y*e.domElement.height/r;if(a)return Math.round(a/t.material.map.imageHeight)}}return 0}(this,t,e));this.material.map.fontSize=Math.max(this.minFontSize,Math.min(i,this.maxFontSize)),this.lastRedraw=Date.now()},t.prototype.dispose=function(){this.material.map.dispose(),this.material.dispose()},Object.defineProperties(t.prototype,e),t}(p.Sprite)});
