!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("three"),require("three.texttexture")):"function"==typeof define&&define.amd?define(["three","three.texttexture"],e):e(t.THREE)}(this,function(t){"use strict";var e=function(t,e,r){this.redraw(t,r)},r=function(r){function i(i){void 0===i&&(i={});var o=i.textSize;void 0===o&&(o=1);var a=i.redrawInterval;void 0===a&&(a=1);var n=i.roundFontSizeToNearestPowerOfTwo;void 0===n&&(n=!0);var s=i.maxFontSize;void 0===s&&(s=1/0);var d=i.material;void 0===d&&(d={});var h=i.texture;void 0===h&&(h={}),r.call(this,new t.SpriteMaterial(Object.assign({},d,{map:new t.TextTexture(h)}))),this.textSize=o,this.redrawInterval=a,this.roundFontSizeToNearestPowerOfTwo=n,this.maxFontSize=s,this.lastRedraw=0,this._renderMesh=new t.Mesh,this._renderMesh.onBeforeRender=e.bind(this),this.add(this._renderMesh)}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={isTextSprite:{configurable:!0}};return o.isTextSprite.get=function(){return!0},i.prototype.updateScale=function(){this.scale.set(this.material.map.aspect,1,1).multiplyScalar(this.textSize)},i.prototype.updateMatrix=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.updateScale(),r.prototype.updateMatrix.apply(this,t)},i.prototype.computeOptimalFontSize=function(t,e){if(t.domElement.width&&t.domElement.height&&this.material.map.textBoxHeight){var r=this.getWorldPosition().distanceTo(e.getWorldPosition());if(r){var i=this.getWorldScale().y*t.domElement.height/r;if(i)return Math.round(i/this.material.map.paddingBoxHeight)}}return 0},i.prototype.redraw=function(t,e){var r=this;this.lastRedraw+this.redrawInterval<Date.now()&&(this.redrawInterval?setTimeout(function(){r.redrawNow(t,e)},1):this.redrawNow(t,e))},i.prototype.redrawNow=function(e,r){this.updateScale();var i=this.computeOptimalFontSize(e,r);this.roundFontSizeToNearestPowerOfTwo&&(i=t.Math.nearestPowerOfTwo(i)),i=Math.min(i,this.maxFontSize),this.material.map.fontSize=i,this.material.map.autoRedraw||this.material.map.redraw(),this.lastRedraw=Date.now()},i.prototype.dispose=function(){this.material.map.dispose(),this.material.dispose()},Object.defineProperties(i.prototype,o),i}((t=t&&t.hasOwnProperty("default")?t.default:t).Sprite);t.TextSprite=r});
