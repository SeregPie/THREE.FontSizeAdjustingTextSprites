(function(a){let b=function(a,b,c){this.updateScale();let d=Date.now();if(d>this.lastRedraw+this.redrawDelay){let b=this.redraw.bind(this,a,c);this.redrawDelay?setTimeout(b):b(),this.lastRedraw=d}};a.TextSprite=class extends a.Sprite{constructor({textSize:textSize=1,redrawDelay:redrawDelay=1,roundFontSizeToNearestPowerOfTwo:roundFontSizeToNearestPowerOfTwo=!0,maxFontSize:maxFontSize=1/0,material:material={},texture:texture={}}={}){super(new a.SpriteMaterial(Object.assign({},material,{map:new a.TextTexture(texture)}))),this.textSize=textSize,this.redrawDelay=redrawDelay,this.roundFontSizeToNearestPowerOfTwo=roundFontSizeToNearestPowerOfTwo,this.maxFontSize=maxFontSize,this.lastRedraw=0;let c=new a.Mesh;c.onBeforeRender=b.bind(this),this.add(c)}calculateOptimalFontSize(a,b){if(a.domElement.width&&a.domElement.height&&!this.material.map.blank){let c=this.getWorldPosition().distanceTo(b.getWorldPosition());if(c)return Math.round(a.domElement.height*this.getWorldScale().y/this.material.map.lineHeight/c)}return 0}updateScale(){this.scale.setX(this.material.map.aspect).setY(1).multiplyScalar(this.textSize)}redraw(b,c){let d=this.calculateOptimalFontSize(b,c);this.roundFontSizeToNearestPowerOfTwo&&(d=a.Math.nearestPowerOfTwo(d)),d=Math.min(d,this.maxFontSize),this.material.map.fontSize=d}},Object.assign(a.TextSprite.prototype,{isTextSprite:!0})}).call(this,THREE);